<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thesis Questionnaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }

        /* Hide all screens by default */
        .screen {
            display: none;
        }
        
        /* Spacing for titles */
        h2.tight-spacing {
            margin-top: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Slider styling */
        .slider-container input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 5px;
        }
        .slider-container input[type="range"]:hover {
            opacity: 1;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        .slider-container input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }

        /* Message box styling */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* Loading indicator for saving data */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 30px;
            height: 30px;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }

        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .feedback-box-container {
            background-color: #111827;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="message-box" class="message-box"></div>

    <div class="max-w-3xl w-full bg-white rounded-xl shadow-2xl p-8 sm:p-12">
        <div id="timer-display" class="hidden absolute top-4 right-4 bg-blue-600 text-white rounded-full h-12 w-12 flex items-center justify-center font-bold text-lg shadow-lg"></div>

        <div id="screen-1" class="screen">
            <h1 class="text-4xl font-bold text-gray-800 mb-6">Welcome and Consent Form</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed">
                <p>
                    <span class="font-bold">Thank you</span> for participating in this <span class="font-bold">research study</span>.
                    This study investigates how individuals approach and perform on a <span class="font-bold">business case task</span>, what they take away from it, and how they feel about the experience, including any <span class="font-bold">feedback</span> they receive.
                    Your participation involves completing a short business case exercise, receiving feedback, and answering a questionnaire about your perceptions and reactions. The entire process should take approximately 5-10 minutes.
                </p>
            </div>
            
            <div class="mt-8">
                <label for="full-name" class="block text-lg font-medium text-gray-700">Please enter your full name:</label>
                <input type="text" id="full-name" placeholder="Name and Surname" class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>

            <h2 class="text-2xl font-semibold mt-6 mb-2">Data Use and Privacy</h2>
            <div class="space-y-4 text-gray-700 leading-relaxed">
                <p>
                    By participating, you agree that the data you provide may be analyzed and used for academic research purposes. Your name and surname will not be included in the thesis or any publication. <br>
                    All data will be treated confidentially and used exclusively for the purposes of this research project.
                </p>
            </div>
            
            <div class="mt-6 flex items-start space-x-3">
                <input type="checkbox" id="consent-checkbox" class="mt-1 h-5 w-5 rounded text-blue-600 border-gray-300 focus:ring-blue-500">
                <label for="consent-checkbox" class="text-gray-700 text-base">By continuing, you confirm that you have read the information above and agree to participate in this study.</label>
            </div>

            <button id="next-1" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-2" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Before we begin the task...</h1>
            <p class="text-gray-700 mb-8 leading-relaxed">Before we begin the task, we’d like to understand how you <span class="font-bold">perceive yourself</span> in relation to business case exercises. Please use the slider to indicate your agreement with each statement. These items refer to your own perceptions of yourself in business case contexts.</p>

            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q1. I have experience working on business cases individually (e.g., for university, assessments, or interview processes)</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q1-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>No experience at all</span>
                            <span>Extensive experience</span>
                        </div>
                        <p id="q1-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q2. I feel familiar with the typical structure of business case problems</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q2-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Not familiar at all</span>
                            <span>Very familiar</span>
                        </div>
                        <p id="q2-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q3. I feel confident in my ability to solve individual business case problems effectively</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q3-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Not confident at all</span>
                            <span>Very confident</span>
                        </div>
                        <p id="q3-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q4. I know effective strategies for approaching business-case questions</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q4-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Not at all</span>
                            <span>Very much so</span>
                        </div>
                        <p id="q4-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
            </div>

            <button id="next-2" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-3" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Get Ready for the Business Case</h1>
            <p class="text-gray-700 leading-relaxed mb-6">You're now about to begin the <span class="font-bold">main</span> part of the study: a short individual <span class="font-bold">business case simulation</span>. This is the most important section of the questionnaire, so please take a moment to focus and minimize distractions.</p>
            <h2 class="text-2xl font-semibold mt-4 mb-2">Structure of the next two steps:</h2>
            <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                <li><span class="font-bold">Step 1:</span> You will be shown a <span class="font-bold">business case prompt</span>. You’ll have <span class="font-bold">120 seconds</span> to read and write your response.</li>
                <li><span class="font-bold">Step 2:</span> You’ll be asked a <span class="font-bold">follow-up question</span>, with <span class="font-bold">90 seconds</span> to respond.</li>
            </ul>
            <p class="text-gray-700 mt-4 leading-relaxed">In both steps, you will write your answer in the text box below, as if you were explaining it to someone else.</p>
            <h2 class="text-2xl font-semibold mt-6 mb-4">📝 Evaluation Criteria</h2>
            <p class="text-gray-700 leading-relaxed">Your response will be assessed based on:</p>
            <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                <li><strong>Completeness</strong> – Did you consider all key elements of the case?</li>
                <li><strong>Correctness</strong> – Is your reasoning sound and relevant?</li>
                <li><strong>Structure</strong> – Did you organize your thoughts clearly, grouping similar variables together into logical clusters to deliver an elegant and easily understandable answer?</li>
            </ul>
            <button id="next-3" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-4" class="screen relative">
            <div id="timer-4" class="hidden absolute top-4 right-4 bg-blue-600 text-white rounded-full h-12 w-12 flex items-center justify-center font-bold text-lg shadow-lg"></div>
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Question 1</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed mb-6">
                <p><strong>Prompt</strong></p>
                <p>A diesel truck manufacturer that primarily sells to 3PL (third-party logistics companies), carriers, and private fleet companies (e.g., Amazon) is considering entering the electric vehicle market. The CEO of the company is asking for your advice on whether they should produce and sell electric trucks (e-trucks).</p>
                <p><strong>Question 1</strong></p>
                <p>What factors do you think the <span class="font-bold">truck manufacturer</span> should assess to decide whether to produce and sell electric trucks (e-trucks)?</p>
            </div>
            <textarea id="q-case-1" class="w-full h-64 p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Write your response here..."></textarea>
            <button id="next-4" class="mt-6 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-5" class="screen relative">
            <div id="timer-5" class="hidden absolute top-4 right-4 bg-blue-600 text-white rounded-full h-12 w-12 flex items-center justify-center font-bold text-lg shadow-lg"></div>
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Question 2</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed mb-6">
                <p><strong>Prompt</strong></p>
                <p>Now consider the perspective of potential customers.</p>
                <p><strong>Question 2</strong></p>
                <p>What key criteria and factors influence <span class="font-bold">customers’ decisions</span> to choose an electric truck instead of a diesel one?</p>
            </div>
            <textarea id="q-case-2" class="w-full h-64 p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Write your response here..."></textarea>
            <button id="next-5" class="mt-6 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-6" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Feedback and Score Preview</h1>
            <p class="text-gray-700 mb-8 leading-relaxed">
                In the next step, you will receive <span class="font-bold">personalized feedback</span> on your <span class="font-bold">performance</span> in the two business-case questions, along with a score from 1 to 10. Your responses will be evaluated by an <span class="font-bold">AI model</span> based on clear and objective criteria, including <span class="font-bold">completeness</span>, <span class="font-bold">correctness</span>, and <span class="font-bold">structure</span>. To encourage learning and comparison, your <span class="font-bold">results</span> will be <span class="font-bold">grouped</span> with those of other participants and will be <span class="font-bold">shared</span> and <span class="font-bold">made visible</span> at the end of the survey. Below, you can already see feedback and scores from two previous participants:
            </p>
            
            <div class="feedback-box-container text-white">
                <div class="text-center font-semibold mb-4">Feedbacks are constantly updating...</div>
                <div class="space-y-6">
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="flex justify-between items-center mb-4 text-sm text-gray-400">
                            <div><div class="text-gray-100 font-semibold">Alessio Romano</div><span class="feedback-time-1"></span></div><span class="font-semibold">Score: 8.5/10</span>
                        </div>
                        <p class="text-gray-200">Both of your responses were well-structured. You correctly identified most of the key drivers related to the market, company strategy, and financial aspects in the first question. In the second question, you identified the drivers related to costs, revenues, investments, and strategic value. However, in both questions, you missed the factors related to potential market entry risks (question 1) and operational and financial risks (question 2).</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="flex justify-between items-center mb-4 text-sm text-gray-400">
                            <div><div class="text-gray-100 font-semibold">Giulia Ferri</div><span class="feedback-time-2"></span></div><span class="font-semibold">Score: 5.5/10</span>
                        </div>
                        <p class="text-gray-200">Both of your responses were poorly structured. In the first question, you correctly identified most of the drivers related to the market and financial aspects. In the second question, you identified drivers related to costs, revenues, and investments. However, in both questions, you missed the factors related to potential market entry risks (question 1), operational and financial risks (question 2), commercial factors (question 1), and potential strategic factors (question 2).</p>
                    </div>
                </div>
            </div>

            <button id="next-6" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>
        
        <script>
            function updateFeedbackTimes() {
                const now = new Date();
                const currentHour = now.getHours();

                let time1, time2;

                if (currentHour >= 0 && currentHour < 10) { // Morning (before 10:00 AM)
                    time1 = '15 minutes ago';
                    time2 = '10 hours ago';
                } else { // Standard time
                    time1 = '20 minutes ago';
                    time2 = '2 hours and 13 minutes ago';
                }

                document.querySelector('.feedback-time-1').textContent = `Last updated: ${time1}`;
                document.querySelector('.feedback-time-2').textContent = `Last updated: ${time2}`;
            }

            // Call on load and on screen 6 display
            updateFeedbackTimes();
            
            // Re-run the time update when screen 6 is shown (simplified to just re-run periodically if needed)
            // Note: In a real app, this would be triggered by the navigation logic
        </script>

        <div id="screen-7" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Your Results</h1>
            <p id="loading-feedback" class="text-center text-lg text-gray-500">Generating your score and feedback... this may take a moment.</p>
            <div id="feedback-content" class="hidden">
                <div class="bg-blue-50 p-8 rounded-xl border border-blue-200 text-center">
                    <p class="text-xl font-semibold text-gray-700">Your Score:</p>
                    <p class="text-6xl font-extrabold text-blue-600 mt-2">
                        <span id="user-score">🎯 7 / 10</span>
                    </p>
                </div>
                <div class="mt-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">AI Feedback on Your Performance</h2>
                    <p id="user-feedback" class="text-gray-700 leading-relaxed"></p>
                </div>
            </div>
            <button id="next-7" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors hidden">Next</button>
        </div>

        <div id="screen-8" class="screen relative">
    <div class="absolute top-4 right-4">
      <div class="flex items-center gap-2 bg-white border border-gray-200 rounded-full px-3 py-1 shadow-sm">
        <span class="text-xs font-semibold text-gray-700">1/4</span>
        <div class="flex items-center gap-1"><span class="inline-block h-1.5 w-1.5 rounded-full bg-blue-600"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span></div>
      </div>
    </div>

            <h1 class="text-3xl font-bold text-gray-800 mb-6">Experience with the Business Case</h1>
            <p class="text-gray-700 mb-8 leading-relaxed">Please answer the following questions about your experience with the business case and feedback process. Use the slider to indicate your level of agreement.</p>

            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q5. When receiving the feedback, I focused on…</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q5-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>what to change to improve my performance</span>
                            <span>how others might view my result</span>
                        </div>
                        <p id="q5-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q6. To what extent was your attention on how others would judge or think about your result when receiving the feedback</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q6-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Not at all</span>
                            <span>Very much</span>
                        </div>
                        <p id="q6-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q7. The feedback I just received would be useful for improving my result if there were another attempt.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q7-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Not at all</span>
                            <span>Very much so</span>
                        </div>
                        <p id="q7-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
                
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q8. Engaging with the feedback was a pleasant experience.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q8-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Not at all</span>
                            <span>Very much so</span>
                        </div>
                        <p id="q8-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
            </div>
            <button id="next-8" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-9" class="screen relative">
    <div class="absolute top-4 right-4">
      <div class="flex items-center gap-2 bg-white border border-gray-200 rounded-full px-3 py-1 shadow-sm">
        <span class="text-xs font-semibold text-gray-700">2/4</span>
        <div class="flex items-center gap-1"><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-blue-600"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span></div>
      </div>
    </div>

            <h1 class="text-3xl font-bold text-gray-800 mb-6">About the result</h1>
            <p class="text-gray-700 mb-8 leading-relaxed">Please answer the following questions based on how you feel about your performance in the business case.</p>
            
            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q9. Does the result of the exercise reflect more the effort you put in or your abilities in solving business cases?</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q9-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>mainly effort</span>
                            <span>mainly ability</span>
                        </div>
                        <p id="q9-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q10. The result was largely driven by the task characteristics, its clarity, or how the feedback was computed, and therefore does not strongly reflect my business capabilities.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q10-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Strongly disagree</span>
                            <span>Strongly agree</span>
                        </div>
                        <p id="q10-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q11. The effort I put in was a key cause of this result.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q11-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Strongly disagree</span>
                            <span>Strongly agree</span>
                        </div>
                        <p id="q11-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q12. I would be able to correct my mistakes if there were a next attempt.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q12-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Strongly disagree</span>
                            <span>Strongly agree</span>
                        </div>
                        <p id="q12-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q13. With sustained practice on this kind of exercise, I could significantly improve my performance.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q13-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Strongly disagree</span>
                            <span>Strongly agree</span>
                        </div>
                        <p id="q13-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
            </div>
            <button id="next-9" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-10" class="screen relative">
    <div class="absolute top-4 right-4">
      <div class="flex items-center gap-2 bg-white border border-gray-200 rounded-full px-3 py-1 shadow-sm">
        <span class="text-xs font-semibold text-gray-700">3/4</span>
        <div class="flex items-center gap-1"><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-blue-600"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span></div>
      </div>
    </div>

            <h1 class="text-3xl font-bold text-gray-800 mb-6">Thoughts on Improvement</h1>
            <p class="text-gray-700 mb-8 leading-relaxed">Please answer the following questions based on your thoughts about improving your performance on this type of task.</p>
            
            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q14. After receiving the feedback, I clearly understand the criteria that define a high quality response for this task.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q14-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Strongly disagree</span>
                            <span>Strongly agree</span>
                        </div>
                        <p id="q14-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q15. After receiving the feedback, I can identify what my answer is missing relative to a well done answer.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q15-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Strongly disagree</span>
                            <span>Strongly agree</span>
                        </div>
                        <p id="q15-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q16. After receiving the feedback, the distance between my current level and what would count as an excellent answer feels manageable.</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q16-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Strongly disagree</span>
                            <span>Strongly agree</span>
                        </div>
                        <p id="q16-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q17. Now imagine participating again in a similar exercise: what would be your main goal?</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="7" value="4" class="w-full" id="q17-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>improving my previous performance</span>
                            <span>improving how others see me in a business context</span>
                        </div>
                        <p id="q17-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
            </div>
            <button id="next-10" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <div id="screen-11" class="screen relative">
    <div class="absolute top-4 right-4">
      <div class="flex items-center gap-2 bg-white border border-gray-200 rounded-full px-3 py-1 shadow-sm">
        <span class="text-xs font-semibold text-gray-700">4/4</span>
        <div class="flex items-center gap-1"><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-gray-300"></span><span class="inline-block h-1.5 w-1.5 rounded-full bg-blue-600"></span></div>
      </div>
    </div>

            <h1 class="text-3xl font-bold text-gray-800 mb-6">Final questions (unrelated to the case)</h1>
            <p class="text-gray-700 mb-8 leading-relaxed">The following questions are <span class="font-bold">not related</span> to the business case. Please answer them based on your <span class="font-bold">general thoughts</span> and <span class="font-bold">feelings</span> in everyday or professional situations. Use the slider to indicate how much each statement describes you, where: <strong>0 = Not at all</strong> | <strong>7 = Completely</strong></p>
            
            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q18. I avoid situations where others might evaluate me</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="7" value="4" class="w-full" id="q18-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>7</span>
                        </div>
                        <p id="q18-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q19. I feel nervous when I have to speak or perform in front of other people</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="7" value="4" class="w-full" id="q19-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>7</span>
                        </div>
                        <p id="q19-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q20. I feel anxious before sharing my opinions in meetings</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="7" value="4" class="w-full" id="q20-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>7</span>
                        </div>
                        <p id="q20-value" class="text-center mt-2 text-lg font-semibold text-blue-600">4</p>
                    </div>
                </div>
            </div>
            <button id="next-11" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>
        
        <div id="screen-12" class="screen">
            <div id="sending-data" class="flex flex-col items-center justify-center p-8">
                <div class="loader"></div>
                <p class="mt-4 text-center text-lg text-gray-600">Invio delle risposte in corso...</p>
            </div>
            <div id="submission-success" class="hidden">
                <h1 class="text-4xl font-bold text-gray-800 mb-6 leading-tight"><span class="font-bold">Thank you for your time and effort.</span></h1>
                <div class="space-y-4 text-gray-700 leading-relaxed">
                    <p>Before concluding, we'd like clarify how your <span class="font-bold">data</span> will be <span class="font-bold">used</span> and the <span class="font-bold">purpose of this study</span>.</p>
                    <p>The <span class="font-bold">business case</span> you were asked to complete was <span class="font-bold">used</span> as the <span class="font-bold">source data</span> for the <span class="font-bold">feedback you received</span>. The <span class="font-bold">primary goal</span> of this <span class="font-bold">study</span> is to understand <span class="font-bold">how people react</span> to <span class="font-bold">receiving such feedback</span>, and how this <span class="font-bold">differs</span> when <span class="font-bold">people feel</span> the <span class="font-bold">feedback</span> is <span class="font-bold">shared versus anonymous</span>.</p>
                    <p>At the beginning of the questionnaire, we asked you to <span class="font-bold">enter your name and surname</span>. Later on, you were shown scenarios in which feedback and performance scores <span class="font-bold">appeared</span> to be <span class="font-bold">visible</span> to other participants and <span class="font-bold">compared publicly</span>. These were <span class="font-bold">fictional participants</span>.</p>
                    <p><span class="font-bold">Your name</span> and <span class="font-bold">business case</span> answers are <span class="font-bold">not being shared nor stored</span>, and are <span class="font-bold">not accessible</span> to the <span class="font-bold">researcher</span>. <br>
                    <span class="font-bold">Only your answers</span> to the other <span class="font-bold">questions</span> will be <span class="font-bold">used in the study</span> so all <span class="font-bold">data</span> is <span class="font-bold">completely anonymous</span> and your <span class="font-bold">privacy is fully protected</span>.</p>
                    <p><span class="font-bold">Thank you again for your participation.</span></p>
                </div>
            </div>
            <div id="submission-error" class="hidden">
                <h1 class="text-4xl font-bold text-gray-800 mb-6">Ops, qualcosa è andato storto!</h1>
                <p class="text-lg text-gray-700">Non siamo riusciti a inviare le tue risposte. Per favore, prova ad aggiornare la pagina e riprovare, o contatta il ricercatore. Ci scusiamo per l'inconveniente.</p>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAGQ6MY4e90TIAfS2Qccal6yQZiVps0pvA",
            authDomain: "tesi-feedback-pubblico.firebaseapp.com",
            projectId: "tesi-feedback-pubblico",
            storageBucket: "tesi-feedback-pubblico.firebasestorage.app",
            messagingSenderId: "415179890467",
            appId: "1:415179890467:web:c56a8bf7e2ed63c0533696",
            measurementId: "G-12KVD24LET"
        };

        // This appId is used for the Firestore collection path
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // Global state to store user's answers and progress
        const state = {
            currentScreen: 1,
            name: '',
            consent: false,
            q1: 4, q2: 4, q3: 4, q4: 4,
            q_case_1: '',
            q_case_2: '',
            q5: 4, q6: 4, q7: 4, q8: 4,
            q9: 4, q10: 4, q11: 4, q12: 4, q13: 4,
            q14: 4, q15: 4, q16: 4, q17: 4,
            q18: 4, q19: 4, q20: 4,
            aiScore: 0,
            aiFeedback: ''
        };

        // Gemini API configuration
        const GEMINI_API_KEY = "AIzaSyBiKlgq8Idj9MorHSH73-QYBeJfe7LQInc";
        const GEMINI_MODEL = "gemini-2.5-flash-preview-05-20";
        
        let db;
        let auth;
        let isAuthReady = false;

        // Function to initialize Firebase and authenticate the user
        async function initializeFirebase() {
            try {
                console.log("Initializing Firebase...");
                // Use the special __firebase_config variable if available
                const firebaseConfigFromEnv = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
                const app = initializeApp(firebaseConfigFromEnv);
                db = getFirestore(app);
                auth = getAuth(app);

                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                
                onAuthStateChanged(auth, async (user) => {
                  if (user) {
                    isAuthReady = true;
                    console.log("Firebase initialized and authenticated successfully. User UID:", user.uid);
                  } else {
                    isAuthReady = false;
                    console.log("Firebase authentication state changed to 'signed out'. Signing in anonymously...");
                    await signInAnonymously(auth);
                  }
                });
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Error initializing Firebase:", error);
            }
        }
        
        initializeFirebase();

        // UI Elements
        const screens = document.querySelectorAll('.screen');
        const nextButtons = document.querySelectorAll('[id^="next-"]');
        const sliders = document.querySelectorAll('input[type="range"]');
        const messageBox = document.getElementById('message-box');
        const timerDisplay = document.getElementById('timer-display');

        // Helper functions
        function showScreen(screenNumber) {
            screens.forEach(screen => screen.style.display = 'none');
            document.getElementById(`screen-${screenNumber}`).style.display = 'block';
            state.currentScreen = screenNumber;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Re-run the time update when screen 6 is shown
            if (screenNumber === 6) {
                updateFeedbackTimes();
            }
        }

        function showMessage(text) {
            messageBox.textContent = text;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.opacity = '1';
            }, 10);
            setTimeout(() => {
                messageBox.style.opacity = '0';
                setTimeout(() => messageBox.style.display = 'none', 500);
            }, 3000);
        }

        // Update slider value display and state
        sliders.forEach(slider => {
            const valueDisplay = document.getElementById(slider.id.replace('slider', 'value'));
            slider.addEventListener('input', () => {
                if (valueDisplay) {
                    valueDisplay.textContent = slider.value;
                }
                const key = slider.id.replace('-slider', '');
                state[key] = parseInt(slider.value, 10);
            });
        });

        // Timer function for timed questions
        let timerInterval;
        function startTimer(duration, onFinish) {
            let timer = duration;
            timerDisplay.style.display = 'flex';
            timerDisplay.textContent = timer;

            timerInterval = setInterval(() => {
                timer--;
                timerDisplay.textContent = timer;
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.style.display = 'none';
                    onFinish();
                }
            }, 1000);

            return timerInterval;
        }

        // --- Gemini API call for AI feedback ---
        async function getFeedbackFromAI() {
            document.getElementById('loading-feedback').style.display = 'block';
            document.getElementById('feedback-content').style.display = 'none';
            // Hide the Next button while loading
            document.getElementById('next-7').classList.add('hidden');

            const prompt = `You are an expert evaluator assessing consulting-style business case responses. You will receive two answers to a business case and must evaluate each individually, assigning a score from 1 to 10 per answer based on clearly defined criteria. Then, provide a structured and standardized feedback paragraph. Finally, calculate the overall score as the average of the two individual scores (rounded to one decimal place). 
 📌 Business Case Prompt: 

 A diesel truck manufacturer that primarily sells to 3PL (third-party logistics companies), carriers, and private fleet companies (e.g., Amazon) is considering entering the electric vehicle market. The CEO of the company is asking for your advice on whether they should produce and sell electric trucks (e-trucks). 
 🔹 Question 1: 
What factors do you think the truck manufacturer should assess to decide whether to produce and sell electric trucks (e-trucks)?

 🔹 Reference solution for Question 1: 
 -E-truck market 
 --Size and growth rate 
 --Largest e-truck producers (incl. market shares and key differentiating points) 
 --Average margin in the space 
 -Diesel truck manufacturer 
 --Target customer segments for e-trucks (same B2B or B2C too?) 
 --Expected e-truck model (e.g., type, key selling points) 
 --Distribution (own/partner dealerships; online; etc.) 
 -Valuation 
 --Expected capex 
 --Investment criteria (e.g., ROI, NPV, payback period) 
 --Expected profitability (incl. synergy analysis): 
 ---Revenue 
 ---Costs 
 -Market entry risks 
 --Market-specific risks 
 --Financial risks 
 --Operational risks 

 🟠 Scoring criteria for Question 1 (1–10 points): 
 Structure (0–2 pts) 
 2 = well-structured mentioning 3 or all 4 key areas of the reference solution - E-truck market, Manufacturer, Valuation, Market-entry risk (the meaning must be the same, but not necessarily the same term)
 1.75–1 = alternative structure but complete and logical with at least 2 areas
 1–0.25 = some structure, but lacking or unbalanced 
 0 = no logical structure or disorganized 
 
Factors/Variables (1–8 pts) 
 8+ variables = 8 
 7 variables = 7,5
 6 variables = 6,5 
 5 variables = 5,5  
 4 variables = 4,5 
 3 variables = 3,5 
 2 variables = 2,5 
 1 variables = 1,5
 0 variables 0

 
 🔹 Question 2: 
What key criteria and factors influence customers’ decisions to choose an electric truck instead of a diesel one?

 🔹 Reference solution for Question 2: 
 -Financial analysis 
 --Cost factors: 
 ---Truck price 
 ---Maintenance (spare parts, services) 
 ---Fuel/electricity consumption 
 ---Insurance 
 --Revenue factors: 
 ---Truck's useful life 
 ---Capacity (power, payload, mileage) 
 ---Utilization rate (due to fewer repairs) 
 ---Salvage value 
 --Investment: 
 ---ROI/payback 
 ---Capex for charging stations 
 -Strategic value 
 --Customer experience improvements 
 --Brand image (eco-friendly) 
 --Risk diversification 
 --Less dependency on oil/gas 
 --Lower legal/pollution compliance risks 
 -Risks 
 --Operational risks: 
 ---Lack of support infrastructure (mechanics, service stations) 
 ---Dual-fleet complexity 
 ---Immature tech (design flaws) 
 ---Charging time 
 ---Lack of charging stations 
 --Financial risks: 
 ---Loss of scale economies 
 ---Underestimated costs or optimistic revenues 

🟠 Scoring criteria for Question 2 (1–10 points): 
 Structure (0–2 pts) 
 2 = well-structured mentioning 2 or all 3 key areas of the reference solution - Financial analysis (cost and revenue), Strategic value, Risk (operational and financial) (the meaning must be the same, but not necessarily the same term)
 1.75–1 = alternative structure but complete and logical with at least 2 areas
 1–0.25 = some structure, but lacking or unbalanced 
 0 = no logical structure or disorganized 
 
Factors/Variables (1–8 pts) 
 8+ variables = 8 
 7 variables = 7,5
 6 variables = 6,5 
 5 variables = 5,5  
 4 variables = 4,5 
 3 variables = 3,5 
 2 variables = 2,5 
 1 variables = 1,5
 0 variables 0


Your feedback must follow this exact structure, adapted to the candidate’s performance. Fill in the brackets accordingly: 
The answer to Question 1 was [well structured and included all key areas / well structured but missed some key areas such as... / poorly structured but followed a logical flow; it could have been structured into the following 4 areas... / poorly structured and lacked logical order; it could have been organized into the following areas...]. 

 You included [all / most / a good portion / some / very few] of the key variables relevant to answering this type of question. [You missed / you could have also included / you should have considered] the following: [...] (write a miximun of 6 additional or missing factors)
 In Question 2, you [structured your answer well / attempted to organize it but could have used the following structure... / did not structure your answer and could have done so like this...]. 

 You included [many variables across diverse areas / many variables but focused on a narrow set / a reasonable number of variables across some areas / only a few variables]. 

 Additional relevant factors you could have included: [...] (write a maximun of 6 additional or missing factors). 

FINAL OUTPUT FORMAT (return ONLY and EXACTLY the fields below, no markdown, no extra text)
Score_Q1: [numeric score 0–10 with one decimal if needed]
Score_Q2: [numeric score 0–10 with one decimal if needed]
Score_Average: [average of Score_Q1 and Score_Q2, rounded to ONE decimal place]
Feedback:
[single paragraph of feedback]

Here are the user's answers:
---
Question 1 Answer:
${state.q_case_1}

Question 2 Answer:
${state.q_case_2}
---
Return ONLY the four fields in the format above. Do not add any other text.`;
const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
            };

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

            let retries = 0;
            const maxRetries = 5;
            const baseDelay = 1000; // 1 second

            async function fetchWithExponentialBackoff() {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429 && retries < maxRetries) {
                        const delay = baseDelay * Math.pow(2, retries);
                        retries++;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return await fetchWithExponentialBackoff();
                    } else if (!response.ok) {
                         throw new Error(`API error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
const scoreQ1Match = text.match(/Score_Q1:\s*([\d.]+)/);
const scoreQ2Match = text.match(/Score_Q2:\s*([\d.]+)/);
let scoreAvgMatch = text.match(/Score_Average:\s*([\d.]+)/);
const feedbackMatch = text.match(/Feedback:\s*([\s\S]*)/);
if (!scoreAvgMatch && scoreQ1Match && scoreQ2Match) {
  const q1 = parseFloat(scoreQ1Match[1]);
  const q2 = parseFloat(scoreQ2Match[1]);
  const avg = Math.round(((q1 + q2) / 2) * 10) / 10;
  scoreAvgMatch = ['Score_Average', String(avg)];
}
                        if (scoreAvgMatch && feedbackMatch) {
                            state.aiScore = parseFloat(scoreAvgMatch[1]);
                            state.aiFeedback = feedbackMatch[1].trim();

                            document.getElementById('user-score').textContent = `🎯 ${state.aiScore.toFixed(1)} / 10`;
                            document.getElementById('user-feedback').textContent = state.aiFeedback;

                            document.getElementById('loading-feedback').style.display = 'none';
                            document.getElementById('feedback-content').style.display = 'block';
                            // Show the Next button now that feedback is ready
                            document.getElementById('next-7').classList.remove('hidden');
                        } else {
                            throw new Error("AI response format is unexpected or missing Score_Average/Feedback.");
                        }
                    } else {
                        throw new Error("AI response content is missing or malformed.");
                    }
                } catch (error) {
                    console.error('Error fetching AI feedback:', error);
                    showMessage("An error occurred while generating feedback. Please try again.");
                    document.getElementById('loading-feedback').textContent = "Failed to load feedback.";
                }
            }
            
            fetchWithExponentialBackoff();
        }

        // --- Function to save data to Firestore ---
        async function sendDataToFirestore() {
            document.getElementById('sending-data').style.display = 'flex';
            document.getElementById('submission-success').style.display = 'none';
            document.getElementById('submission-error').style.display = 'none';

            // Retry logic with a short delay if Firebase is not ready
            let attempts = 0;
            while (!isAuthReady && attempts < 10) { 
                console.log(`Firestore not ready, retrying in 500ms... (Attempt ${attempts + 1})`);
                await new Promise(resolve => setTimeout(resolve, 500));
                attempts++;
            }

            if (!isAuthReady || !db) {
                console.error("Firestore is not ready after multiple attempts. Aborting data save.");
                document.getElementById('sending-data').style.display = 'none';
                document.getElementById('submission-error').style.display = 'block';
                return;
            }

            // Data object to be saved
            const data = {
                timestamp: new Date().toISOString(),
                name: state.name,
                q1: state.q1, q2: state.q2, q3: state.q3, q4: state.q4,
                q_case_1: state.q_case_1,
                q_case_2: state.q_case_2,
                q5: state.q5, q6: state.q6, q7: state.q7, q8: state.q8,
                q9: state.q9, q10: state.q10, q11: state.q11, q12: state.q12, q13: state.q13,
                q14: state.q14, q15: state.q15, q16: state.q16, q17: state.q17,
                q18: state.q18, q19: state.q19, q20: state.q20,
                aiScore: state.aiScore,
                aiFeedback: state.aiFeedback
            };
            
            try {
                // Save data to the public 'risposte' collection
                const collectionPath = `artifacts/${appId}/public/data/risposte`;
                console.log("Attempting to save data to Firestore collection:", collectionPath);
                await addDoc(collection(db, collectionPath), data);
                
                document.getElementById('sending-data').style.display = 'none';
                document.getElementById('submission-success').style.display = 'block';
                console.log("Data successfully sent to Firestore!");
            } catch (error) {
                console.error('Error sending data to Firestore:', error);
                document.getElementById('sending-data').style.display = 'none';
                document.getElementById('submission-error').style.display = 'block';
            }
        }


        // --- Event Handlers ---
        nextButtons.forEach(button => {
            button.addEventListener('click', () => {
                const buttonId = button.id;
                switch (buttonId) {
                    case 'next-1':
                        const fullName = document.getElementById('full-name').value.trim();
                        const consent = document.getElementById('consent-checkbox').checked;
                        if (fullName && consent) {
                            state.name = fullName;
                            showScreen(2);
                        } else {
                            showMessage("Please enter your full name and agree to participate.");
                        }
                        break;
                    case 'next-2':
                        showScreen(3);
                        break;
                    case 'next-3':
                        showScreen(4);
                        // Start the timer for screen 4 (120 seconds)
                        window.timerInterval = startTimer(120, () => {
                            // Auto-advance logic for screen 4
                            state.q_case_1 = document.getElementById('q-case-1').value.trim();
                            showScreen(5);
                            // Start the timer for screen 5 (90 seconds)
                            window.timerInterval = startTimer(90, () => {
                                // Auto-advance logic for screen 5
                                state.q_case_2 = document.getElementById('q-case-2').value.trim();
                                showScreen(6);
                            });
                        });
                        break;
                    case 'next-4':
                        // Clear the timer for screen 4
                        if (window.timerInterval) {
                            clearInterval(window.timerInterval);
                            timerDisplay.style.display = 'none';
                        }
                        // Save the answer from screen 4
                        state.q_case_1 = document.getElementById('q-case-1').value.trim();
                        if (state.q_case_1) {
                            showScreen(5);
                            // Start the timer for screen 5 (90 seconds)
                            window.timerInterval = startTimer(90, () => {
                                // Auto-advance logic for screen 5
                                state.q_case_2 = document.getElementById('q-case-2').value.trim();
                                showScreen(6);
                            });
                        } else {
                            showMessage("Please provide your answer before proceeding.");
                        }
                        break;
                    case 'next-5':
                        // Clear the timer for screen 5
                        if (window.timerInterval) {
                            clearInterval(window.timerInterval);
                            timerDisplay.style.display = 'none';
                        }
                        // Save the answer from screen 5
                        state.q_case_2 = document.getElementById('q-case-2').value.trim();
                        if (state.q_case_2) {
                            showScreen(6);
                        } else {
                            showMessage("Please provide your answer before proceeding.");
                        }
                        break;
                    case 'next-6':
                        showScreen(7);
                        getFeedbackFromAI();
                        break;
                    case 'next-7':
                        showScreen(8);
                        break;
                    case 'next-8':
                        showScreen(9);
                        break;
                    case 'next-9':
                        showScreen(10);
                        break;
                    case 'next-10':
                        showScreen(11);
                        break;
                    case 'next-11':
                        state.q18 = parseInt(document.getElementById('q18-slider').value, 10);
                        state.q19 = parseInt(document.getElementById('q19-slider').value, 10);
                        state.q20 = parseInt(document.getElementById('q20-slider').value, 10);
                        showScreen(12);
                        sendDataToFirestore();
                        break;
                }
            });
        });

        // Initial screen display
        showScreen(1);
    </script>
</body>
</html>